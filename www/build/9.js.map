{"version":3,"sources":["../../src/pages/modal-calidades-albaran/modal-calidades-albaran.module.ts","../../src/pages/modal-calidades-albaran/modal-calidades-albaran.ts"],"names":[],"mappings":"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","file":"9.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { ModalCalidadesAlbaranPage } from './modal-calidades-albaran';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ModalCalidadesAlbaranPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ModalCalidadesAlbaranPage),\r\n  ],\r\n})\r\nexport class ModalCalidadesAlbaranPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/modal-calidades-albaran/modal-calidades-albaran.module.ts","import { Component } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams, ViewController, AlertController, LoadingController  } from 'ionic-angular';\r\nimport { AriagroDataProvider } from '../../providers/ariagro-data/ariagro-data';\r\nimport { LocalDataProvider } from '../../providers/local-data/local-data';\r\nimport * as numeral from 'numeral';\r\n\r\n\r\n\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-modal-calidades-albaran',\r\n  templateUrl: 'modal-calidades-albaran.html',\r\n})\r\nexport class ModalCalidadesAlbaranPage {\r\n\r\n  settings: any = {};\r\n  campanya: any = {};\r\n  user: any = {};\r\n  entrada: any = {};\r\n  calidades: any = [];\r\n  incidencias: any = [];\r\n  loading: any;\r\n  correo: any;\r\n\r\n  constructor(public navCtrl: NavController, public navParams: NavParams, public viewCtrl: ViewController,\r\n     public localData: LocalDataProvider, public alertCrtl: AlertController, public loadingCtrl: LoadingController, \r\n     public ariagroData: AriagroDataProvider) {\r\n  }\r\n\r\n  ionViewDidLoad() {\r\n    this.localData.getSettings().then(data => {\r\n      if (data) {\r\n        this.settings = JSON.parse(data);\r\n        this.viewCtrl.setBackButtonText('');\r\n        this.user = this.settings.user;\r\n        this.campanya = this.settings.campanya;\r\n        this.entrada = this.navParams.get('entrada');\r\n        this.loadCalidades();\r\n\r\n      } else {\r\n        this.navCtrl.setRoot('ParametrosPage');\r\n      }\r\n    });\r\n  }\r\n\r\n  loadCalidades(): void {\r\n    let loading = this.loadingCtrl.create({ content: 'Buscando clasificacion...' });\r\n    loading.present();\r\n    this.ariagroData.getAlbaranClasificacion(this.settings.parametros.url, this.entrada.numalbar, this.campanya.ariagro)\r\n    .subscribe(\r\n      (data) => {\r\n        loading.dismiss();\r\n        this.calidades = this.prepareData(data[0]);\r\n        this.incidencias = this.prepareIncidencias(data[1]);\r\n      },\r\n      (error) => {\r\n        loading.dismiss();\r\n        this.showAlert(\"ERROR\", JSON.stringify(error, null, 4));\r\n      }\r\n    );\r\n  }\r\n\r\n  prepareData(calidades): any {\r\n    var contador = 1;\r\n    calidades.forEach(a => {\r\n      if(a.kilos != null) {\r\n        a.contador = contador++;\r\n        a.kilos = numeral(a.kilos).format('0,0');\r\n      }\r\n    });\r\n    return calidades;\r\n  }\r\n\r\n  prepareIncidencias(incidencias): any {\r\n    var contador = 1;\r\n    incidencias.forEach(a => {\r\n        a.contador = contador++;\r\n      });\r\n    return incidencias;\r\n  }\r\n\r\n  comprobarCorreo(): void {\r\n    var emailRegex = /^[-\\w.%+]{1,64}@(?:[A-Z0-9-]{1,63}\\.){1,125}[A-Z]{2,63}$/i;\r\n    //Se muestra un texto a modo de ejemplo, luego va a ser un icono\r\n    if(this.correo) {\r\n      this.settings.user.email = this.correo;\r\n    }\r\n    if (emailRegex.test(this.settings.user.email)) {\r\n      this.loading = this.loadingCtrl.create({ content: 'Enviando correo...' });\r\n      this.loading.present();\r\n      this.ariagroData.prepararCorreoClasif(this.settings.parametros.url, this.entrada.numalbar)\r\n      .subscribe(\r\n        (data) => {\r\n          this.enviarCorreo(data);\r\n        },\r\n        (error) => {\r\n          this.showAlert(\"ERROR\", JSON.stringify(error, null, 4));\r\n        }\r\n      );\r\n    } else {\r\n      this.pedirCorreo();\r\n    }\r\n  }\r\n\r\n  enviarCorreo(ruta): void {\r\n    this.ariagroData.enviarCorreoClasif(this.settings.parametros.url, this.entrada.numalbar, this.settings.user.email, ruta)\r\n      .subscribe(\r\n        (data) => {\r\n          this.loading.dismiss();\r\n          this.showAlert(\"\", JSON.stringify(data, null, 4));\r\n        },\r\n        (error) => {\r\n          this.showAlert(\"ERROR\", JSON.stringify(error, null, 4));\r\n        }\r\n      );\r\n  }\r\n\r\n  pedirCorreo() {\r\n    let alert = this.alertCrtl.create({\r\n      title: 'Correo no configurado o incorrecto, introduzca un correo',\r\n      inputs: [\r\n        {\r\n          name: 'Correo',\r\n          placeholder: 'ejemplo@servidor.com'\r\n        },\r\n      ],\r\n      buttons: [\r\n        {\r\n          text: 'Cancelar',\r\n          role: 'cancel',\r\n          handler: data => {\r\n            console.log('Cancel clicked');\r\n          }\r\n        },\r\n        {\r\n          text: 'Aceptar',\r\n          handler: data => {\r\n            this.correo = data.Correo;\r\n            this.comprobarCorreo();\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    alert.present();\r\n  }\r\n\r\n  showAlert(title, subTitle): void {\r\n    let alert = this.alertCrtl.create({\r\n      title: title,\r\n      subTitle: subTitle,\r\n      buttons: ['OK']\r\n    });\r\n    alert.present();\r\n  }\r\n\r\n  dismiss(): void {\r\n    this.viewCtrl.dismiss();\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/modal-calidades-albaran/modal-calidades-albaran.ts"],"sourceRoot":""}